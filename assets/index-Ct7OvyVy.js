var k=l=>{throw TypeError(l)};var N=(l,e,s)=>e.has(l)||k("Cannot "+s);var O=(l,e,s)=>e.has(l)?k("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(l):e.set(l,s);var m=(l,e,s)=>(N(l,e,"access private method"),s);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const n of o.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();class v{constructor(e,s={}){this.elem=e,this.minDistance=s.minDistance||100,this.maxTime=s.maxTime||500,this.corners=s.corners||!1,this.addListeners(),this.events={live:[],after:[]},v.directions().forEach(t=>this.events[t]=[])}static directions(){return["left","right","up","down","leftup","leftdown","rightup","rightdown"]}static position(e){return{x:e.pageX,y:e.pageY}}static getOffsets(e,s){const t=v.position(e);return{x:t.x-s.x,y:t.y-s.y}}static getDirections(e,s){const t={};return t.left=e.x<=0?Math.abs(e.x):0,t.right=e.x>=0?Math.abs(e.x):0,t.up=e.y<=0?Math.abs(e.y):0,t.down=e.y>=0?Math.abs(e.y):0,s&&(t.leftup=Math.abs(t.left+t.up)/1.5,t.leftdown=Math.abs(t.left+t.down)/1.5,t.rightup=Math.abs(t.right+t.up)/1.5,t.rightdown=Math.abs(t.right+t.down)/1.5),t}static order(e){return Object.keys(e).sort((s,t)=>e[t]-e[s])}addEventListener(e,s){const t=Object.keys(this.events);if(t.indexOf(e)===-1)throw new Error("Event is not valid, use "+t.join(", "));this.events[e].push(s);const r=this.events.length-1;return{clear:()=>{this.events[r]=void 0}}}down(e){e.preventDefault(),this.didDown=!0,this.startTime=Date.now(),this.startPos=v.position(e)}move(e){if(e.preventDefault(),!!this.didDown&&(this.didSwipe=!0,this.events.live.length>0)){const s=v.getOffsets(e,this.startPos),t=v.getDirections(s,this.corners),r=v.order(t)[0],o=t[r];this.events.live.forEach(n=>{typeof n=="function"&&n(r,o)})}}up(e){if(e.preventDefault(),this.didDown=!1,!this.didSwipe)return;if(this.didSwipe=!1,Date.now()-this.startTime<=this.maxTime){const t=v.getOffsets(e,this.startPos),r=v.getDirections(t,this.corners),o=v.order(r)[0],n=r[o];n>=this.minDistance&&(this.events.after.forEach(c=>{typeof c=="function"&&c(o,n)}),this.events[o].forEach(c=>{typeof c=="function"&&c(n)}))}}addListeners(){this.elem.addEventListener("pointerdown",e=>this.down(e)),document.addEventListener("pointermove",e=>this.move(e)),document.addEventListener("pointerup",e=>this.up(e))}}function A(l){const e=performance.now();requestAnimationFrame(function s(t){let r=(t-e)/l.duration;r>1&&(r=1);const o=l.timing(r);l.draw(o),r<1&&requestAnimationFrame(s)})}var u,D,b,M,S,E;class x{constructor(e,s,t,r){O(this,u);this.score=0,this.currentScore=s,this.bestScore=t,this.gameOver=r,this.ANIMATION={movementduration:100,scaleduration:100,scale:1.2},this.tiles=[[],[],[],[]];for(let o=0;o<4;o++)for(let n=0;n<4;n++)this.tiles[o][n]=m(this,u,E).call(this,e[o*4+n])}updateScore(){this.currentScore.innerText=this.score,parseInt(localStorage.getItem("2048-best-score"))<this.score&&(localStorage.setItem("2048-best-score",this.score),this.bestScore.innerText=this.score)}newGame(){this.score=0,this.updateScore();for(let e=0;e<4;e++)for(let s=0;s<4;s++)this.tiles[e][s].set(0);m(this,u,D).call(this),m(this,u,D).call(this)}move(e){return m(this,u,M).call(this,...m(this,u,b).call(this,e))}}u=new WeakSet,D=function(){let s=[];for(let r=0;r<4;r++)for(let o=0;o<4;o++)this.tiles[r][o].value===0&&s.push([r,o]);if(s.length===0)return;let t=s[Math.floor(Math.random()*s.length)];Math.floor(Math.random()*11)==10?this.tiles[t[0]][t[1]].set(4):this.tiles[t[0]][t[1]].set(2)},b=function(e){let s=[],t=this.tiles.map(n=>n.map(c=>c.value));const r=[];let o=this.score;for(let n=0;n<4;n++)for(let c=0;c<4;c++){let i;switch(e[0]){case 1:i=[n,c];break;case-1:i=[3-n,c];break;default:switch(e[1]){case 1:i=[c,3-n];break;case-1:i=[c,n];break}}if(t[i[0]][i[1]]===0)continue;let a=[i[0]-e[0],i[1]+e[1]];for(let f=1;;a=[i[0]-e[0]*++f,i[1]+e[1]*f]){if(a[0]<0||a[1]<0||a[0]>3||a[1]>3){if(f===1)break;s.push([i,f-1,!1]),t[a[0]+e[0]][a[1]-e[1]]=t[i[0]][i[1]],t[i[0]][i[1]]=0}else{if(t[a[0]][a[1]]===0)continue;if(t[a[0]][a[1]]===t[i[0]][i[1]]&&!r.some(d=>d===a.toString()))r.push(a.toString()),s.push([i,f,!0]),t[a[0]][a[1]]=t[i[0]][i[1]]*2,t[i[0]][i[1]]=0,o+=t[a[0]][a[1]];else{if(f===1)break;s.push([i,f-1,!1]),t[a[0]+e[0]][a[1]-e[1]]=t[i[0]][i[1]],t[i[0]][i[1]]=0}}break}}return[s,e,t,o]},M=function(e,s,t,r){if(e.length===0)return!0;switch(s[0]){case 1:s="bottom";break;case-1:s="top";break;default:switch(s[1]){case 1:s="left";break;case-1:s="right";break}}const o=this.tiles[0][0].cell.getBoundingClientRect().width,n=o>90?15:10,c=this.ANIMATION,i=this;A({duration:c.movementduration,timing(a){return a},draw(a){for(let f of e){const d=(o+n)*f[1];i.tiles[f[0][0]][f[0][1]].cell.style[s]=a*d+"px"}a===1&&A({duration:c.scaleduration,timing(f){return f},draw(f){for(let d of e){if(!d[2])break;i.tiles[d[0][0]][d[0][1]].cell.style.transform="scale("+f*c.scale+")"}f===1&&A({duration:c.scaleduration/2,timing(d){return d},draw(d){var T;for(let h of e)h[2]&&(i.tiles[h[0][0]][h[0][1]].cell.style.transform="scale("+(c.scale-(c.scale-1)*d)+")");if(d===1){for(let h of e)i.tiles[h[0][0]][h[0][1]].cell.style[s]=null,i.tiles[h[0][0]][h[0][1]].cell.style.transform=null;for(let h=0;h<4;h++)for(let y=0;y<4;y++)i.tiles[h][y].set(t[h][y]);i.score=r,m(T=i,u,S).call(T)}}})}})}})},S=function(){m(this,u,D).call(this),this.updateScore();for(let e of this.tiles)for(let s of e)if(s.value===0)return;!m(this,u,b).call(this,[1,0])[0].length&&!m(this,u,b).call(this,[-1,0])[0].length&&!m(this,u,b).call(this,[0,1])[0].length&&!m(this,u,b).call(this,[0,-1])[0].length&&this.gameOver()},E=function(e){let s={};const t=["","#fae7e0","#f5e6c9","#feb17d","#f59563","#f67c60","#ff5c43","#fad177","#f6cf66","#f9ca58","#fbc52d","#f46674","#f24b5d","#ec3f39","#72b5e0","#5da1e2","#007fc2"];return s.cell=e,s.value=0,s.set=function(r){this.value=r,this.cell.style.backgroundColor=t[this.value?Math.log2(this.value):0],this.cell.textContent=this.value?this.value:"",this.cell.classList=this.value?`tile tile-${this.value}`:"tile"},s};const C=document.querySelector(".gameboard"),I=document.querySelector(".grid-container"),P=Array.from(document.querySelectorAll(".tile")),q=document.querySelector(".retry"),j=document.querySelector(".calc-score"),L=document.querySelector(".best-score"),g=new x(P,j,L,function(){I.style.backgroundColor="#8A0707"}),F=new v(C,{minDistance:50}),w=g.ANIMATION.movementduration+g.ANIMATION.scaleduration*1.5+50;let p=0;localStorage.getItem("2048-best-score")===null&&localStorage.setItem("2048-best-score","0");L.innerText=localStorage.getItem("2048-best-score");q.addEventListener("click",()=>{I.style.backgroundColor=null,g.newGame()});F.addEventListener("after",l=>{if(!(Date.now()-p<w))switch(p=Date.now(),l){case"left":g.move([0,-1]);break;case"right":g.move([0,1]);break;case"up":g.move([1,0]);break;case"down":g.move([-1,0]);break}});document.addEventListener("keydown",l=>{switch(l.key){case"ArrowLeft":if(Date.now()-p<w)return;p=Date.now(),l.preventDefault(),g.move([0,-1]);break;case"ArrowRight":if(Date.now()-p<w)return;p=Date.now(),l.preventDefault(),g.move([0,1]);break;case"ArrowUp":if(Date.now()-p<w)return;p=Date.now(),l.preventDefault(),g.move([1,0]);break;case"ArrowDown":if(Date.now()-p<w)return;p=Date.now(),l.preventDefault(),g.move([-1,0]);break}});g.newGame();
